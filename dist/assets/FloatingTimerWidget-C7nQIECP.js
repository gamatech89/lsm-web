import{r as o,I as F,_ as A,A as K,u as Q,a as V,b as U,c as $,d as v,e as B,j as e,T as S,B as u,f as D,g as N,h as G,R as J,P as X,i as Y,C as Z,S as ee,k as te,l as ne,m as M,n as ie,o as re,p as g}from"./index-sz0gi067.js";var ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"},se=function(c,l){return o.createElement(F,A({},c,{ref:l,icon:ae}))},oe=o.forwardRef(se),le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"},de=function(c,l){return o.createElement(F,A({},c,{ref:l,icon:le}))},ce=o.forwardRef(de);const{Text:x}=N,s={deepPurple:"#440C71",vibrantPurple:"#6B21A8",teal:"#3AA68D",tealLight:"#52B37C",accentViolet:"#A13CF0"};function ue(){const{message:d}=K.useApp(),c=Q(),l=o.useRef(null),y=V(t=>t.user);if((y==null?void 0:y.role)==="admin")return null;const{runningTimer:a,elapsedSeconds:w,setRunningTimer:C,setElapsedSeconds:b,incrementElapsed:L,clearTimer:j,isPopupOpen:O,setIsPopupOpen:m}=U(),[W,I]=o.useState(!1),[f,P]=o.useState(null),[k,R]=o.useState(""),{data:p,isFetching:T}=$({queryKey:["timer","current"],queryFn:()=>g.timer.getCurrent().then(t=>t.data||null),refetchInterval:6e4}),{data:h}=$({queryKey:["timer","projects"],queryFn:()=>g.timer.getProjects().then(t=>t.data.data)}),E=v({mutationFn:t=>g.timer.start(t).then(n=>n.data),onSuccess:t=>{var n;if(t.data){const i=t.data;C({id:i.id,project_id:i.project_id,project_name:((n=i.project)==null?void 0:n.name)||"Unknown",description:i.description,started_at:i.started_at,is_billable:i.is_billable}),b(0),d.success("Timer started!")}P(null),R(""),m(!1),c.invalidateQueries({queryKey:["timer"]})},onError:t=>{var n,i;d.error(((i=(n=t.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to start timer")}}),_=v({mutationFn:t=>g.timer.stop(t).then(n=>n.data),onSuccess:()=>{j(),d.success("Time logged successfully!"),c.invalidateQueries({queryKey:["timer"]}),c.invalidateQueries({queryKey:["time-entries"]})},onError:t=>{var n,i;d.error(((i=(n=t.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to stop timer")}}),q=v({mutationFn:()=>g.timer.discard().then(t=>t.data),onSuccess:()=>{j(),d.info("Timer discarded"),c.invalidateQueries({queryKey:["timer"]})}});o.useEffect(()=>{var t;if(p!=null&&p.data&&!a){const n=p.data;C({id:n.id,project_id:n.project_id,project_name:((t=n.project)==null?void 0:t.name)||"Unknown",description:n.description,started_at:n.started_at,is_billable:n.is_billable}),b(B(n.started_at))}else!(p!=null&&p.data)&&a&&!T&&j()},[p,T]),o.useEffect(()=>{if(!a)return;b(B(a.started_at));const t=setInterval(()=>L(),1e3);return()=>clearInterval(t)},[a==null?void 0:a.id]),o.useEffect(()=>{const t=n=>{const i=n.target;l.current&&l.current.contains(i)||i.closest(".ant-select-dropdown")||i.closest(".ant-popover")||i.closest(".ant-popconfirm")||a||m(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[a]);const H=()=>{if(!f){d.warning("Please select a project");return}E.mutate({project_id:f,description:k||void 0})};return a?W?e.jsx("div",{style:r.floatingContainer,ref:l,children:e.jsx(S,{title:"Expand timer",placement:"left",children:e.jsxs(u,{type:"primary",shape:"round",size:"large",onClick:()=>I(!1),style:r.minimizedPill,children:[e.jsx("div",{style:r.pulsingDotSmall}),e.jsx("span",{style:r.minimizedTime,children:D(w)}),e.jsx(oe,{style:{marginLeft:8,fontSize:14}})]})})}):e.jsx("div",{style:r.floatingContainer,ref:l,children:e.jsxs("div",{style:r.runningWidget,children:[e.jsxs("div",{style:r.runningHeader,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flex:1},children:[e.jsx("div",{style:r.pulsingDot}),e.jsx(x,{style:r.timerTime,children:D(w)})]}),e.jsx(S,{title:"Minimize",children:e.jsx(u,{type:"text",icon:e.jsx(ce,{}),onClick:()=>I(!0),style:{color:"rgba(255,255,255,0.7)"},size:"small"})})]}),e.jsxs("div",{style:r.runningInfo,children:[e.jsx(G,{color:s.vibrantPurple,style:{margin:0},children:a.project_name}),a.description&&e.jsx(x,{style:r.runningDesc,ellipsis:!0,children:a.description})]}),e.jsxs("div",{style:r.runningActions,children:[e.jsx(u,{type:"primary",size:"large",icon:e.jsx(J,{}),onClick:()=>_.mutate({}),loading:_.isPending,style:r.stopButton,block:!0,children:"Stop & Save"}),e.jsx(X,{title:"Discard timer?",description:"Time will not be saved.",onConfirm:()=>q.mutate(),okText:"Discard",placement:"topRight",children:e.jsx(u,{type:"text",danger:!0,icon:e.jsx(Y,{}),style:{color:"rgba(255,255,255,0.7)"}})})]})]})}):e.jsx("div",{style:r.floatingContainer,ref:l,children:O?e.jsx(Z,{style:r.popup,styles:{body:{padding:20}},title:e.jsxs("div",{style:r.popupHeader,children:[e.jsx(re,{style:{color:s.accentViolet,marginRight:8}}),e.jsx("span",{children:"Start Timer"})]}),extra:e.jsx(u,{type:"text",icon:e.jsx(ie,{}),onClick:()=>m(!1),size:"small"}),children:e.jsxs(ee,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(x,{strong:!0,style:r.label,children:"Project"}),e.jsx(te,{placeholder:"Select a project...",style:{width:"100%",marginTop:4},size:"large",value:f,onChange:P,options:(h==null?void 0:h.map(t=>({label:t.name,value:t.id})))||[],loading:!h,showSearch:!0,optionFilterProp:"label",filterOption:(t,n)=>{var i;return(i=n==null?void 0:n.label)==null?void 0:i.toLowerCase().includes(t.toLowerCase())}})]}),e.jsxs("div",{children:[e.jsx(x,{strong:!0,style:r.label,children:"What are you working on?"}),e.jsx(ne.TextArea,{placeholder:"Describe your task...",style:{marginTop:4},rows:2,value:k,onChange:t=>R(t.target.value)})]}),e.jsx(u,{type:"primary",size:"large",icon:e.jsx(M,{}),onClick:H,loading:E.isPending,disabled:!f,style:r.startButtonLarge,block:!0,children:"Start Timer"})]})}):e.jsx(S,{title:"Start Timer",placement:"left",children:e.jsx(u,{type:"primary",shape:"circle",size:"large",icon:e.jsx(M,{style:{fontSize:28}}),onClick:()=>m(!0),style:r.fab})})})}const r={floatingContainer:{position:"fixed",bottom:24,right:24,zIndex:1e3},fab:{width:64,height:64,background:`linear-gradient(135deg, ${s.deepPurple} 0%, ${s.vibrantPurple} 100%)`,border:"none",boxShadow:"0 6px 24px rgba(68, 12, 113, 0.4)",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.2s, box-shadow 0.2s"},popup:{width:320,borderRadius:16,boxShadow:"0 12px 48px rgba(0, 0, 0, 0.2)",border:`1px solid ${s.vibrantPurple}20`},popupHeader:{display:"flex",alignItems:"center",fontWeight:600,fontSize:16},label:{color:"#64748b",fontSize:12,textTransform:"uppercase",letterSpacing:"0.5px"},startButtonLarge:{height:48,background:`linear-gradient(135deg, ${s.teal} 0%, ${s.tealLight} 100%)`,border:"none",fontWeight:600,fontSize:16},runningWidget:{background:`linear-gradient(135deg, ${s.deepPurple} 0%, ${s.vibrantPurple} 100%)`,borderRadius:16,padding:16,minWidth:280,boxShadow:"0 8px 32px rgba(68, 12, 113, 0.5)"},runningHeader:{display:"flex",alignItems:"center",gap:12,marginBottom:12},pulsingDot:{width:12,height:12,borderRadius:"50%",background:"#ef4444",animation:"pulse 2s infinite"},timerTime:{fontFamily:"monospace",fontSize:32,fontWeight:700,color:"#fff",letterSpacing:"2px"},runningInfo:{display:"flex",flexDirection:"column",gap:4,marginBottom:16},runningDesc:{color:"rgba(255, 255, 255, 0.8)",fontSize:13,marginTop:4},runningActions:{display:"flex",gap:8,alignItems:"center"},stopButton:{background:"linear-gradient(135deg, #dc2626 0%, #ef4444 100%)",border:"none",height:44,fontWeight:600},minimizedPill:{display:"flex",alignItems:"center",gap:8,height:48,paddingLeft:16,paddingRight:16,background:`linear-gradient(135deg, ${s.deepPurple} 0%, ${s.vibrantPurple} 100%)`,border:"none",boxShadow:"0 4px 16px rgba(68, 12, 113, 0.4)"},pulsingDotSmall:{width:8,height:8,borderRadius:"50%",background:"#ef4444",animation:"pulse 2s infinite"},minimizedTime:{fontFamily:"monospace",fontSize:18,fontWeight:700,color:"#fff",letterSpacing:"1px"}},z=document.createElement("style");z.textContent=`
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
  }
  
  .timer-fab:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 32px rgba(68, 12, 113, 0.5);
  }
`;document.getElementById("timer-animations")||(z.id="timer-animations",document.head.appendChild(z));export{ue as FloatingTimerWidget};
//# sourceMappingURL=FloatingTimerWidget-C7nQIECP.js.map
